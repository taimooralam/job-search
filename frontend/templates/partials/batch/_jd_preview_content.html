{# JD Preview Sidebar Content #}
{# Loaded via /partials/jd-preview/<job_id> endpoint #}

{% set has_extracted = job.extracted_jd is defined and job.extracted_jd %}
{% set jd = job.extracted_jd if has_extracted else {} %}
{% set desc = job.description or job.job_description or job.jobDescription or '' %}

<!-- Header with job info -->
<div class="mb-4 pb-3 border-b theme-border">
    <h3 class="font-semibold theme-text-primary text-base">{{ job.title or 'Untitled' }}</h3>
    <p class="text-sm theme-text-secondary mt-1">{{ job.company or 'Unknown' }}</p>
    <p class="text-xs theme-text-tertiary mt-0.5">{{ job.location or 'Location N/A' }}</p>
</div>

{% if has_extracted %}
<!-- Extracted JD Info -->
<div class="space-y-3 mb-4">
    {% if jd.role_category %}
    <div class="flex items-center gap-2 text-sm">
        <span class="theme-text-tertiary w-16">Role:</span>
        <span class="theme-text-primary font-medium">{{ jd.role_category | replace('_', ' ') | title }}</span>
    </div>
    {% endif %}
    {% if jd.seniority_level %}
    <div class="flex items-center gap-2 text-sm">
        <span class="theme-text-tertiary w-16">Level:</span>
        <span class="theme-text-primary font-medium">{{ jd.seniority_level | title }}</span>
    </div>
    {% endif %}
</div>

<!-- Skills -->
{% if jd.technical_skills or jd.top_keywords %}
<div class="mb-4">
    <p class="text-sm theme-text-tertiary mb-2 font-medium">Technical Skills</p>
    <div class="flex flex-wrap gap-1.5">
        {% for skill in (jd.technical_skills or jd.top_keywords or []) %}
        <span class="px-2 py-1 text-xs rounded-full theme-bg-secondary theme-text-secondary">{{ skill }}</span>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Key Responsibilities -->
{% if jd.responsibilities %}
<div class="mb-4">
    <p class="text-sm theme-text-tertiary mb-2 font-medium">Key Responsibilities</p>
    <ul class="space-y-2 text-sm theme-text-secondary">
        {% for resp in jd.responsibilities %}
        <li class="flex items-start gap-2">
            <span class="text-accent-500 flex-shrink-0 mt-0.5">›</span>
            <span>{{ resp }}</span>
        </li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<!-- Required Qualifications -->
{% if jd.required_qualifications %}
<div class="mb-4">
    <p class="text-sm theme-text-tertiary mb-2 font-medium">Required Qualifications</p>
    <ul class="space-y-2 text-sm theme-text-secondary">
        {% for qual in jd.required_qualifications %}
        <li class="flex items-start gap-2">
            <span class="text-green-500 flex-shrink-0 mt-0.5">✓</span>
            <span>{{ qual }}</span>
        </li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<!-- Preferred Qualifications -->
{% if jd.preferred_qualifications %}
<div class="mb-4">
    <p class="text-sm theme-text-tertiary mb-2 font-medium">Preferred Qualifications</p>
    <ul class="space-y-2 text-sm theme-text-secondary">
        {% for qual in jd.preferred_qualifications %}
        <li class="flex items-start gap-2">
            <span class="text-blue-500 flex-shrink-0 mt-0.5">○</span>
            <span>{{ qual }}</span>
        </li>
        {% endfor %}
    </ul>
</div>
{% endif %}

{% else %}
<!-- Not analyzed notice -->
<div class="mb-4 p-3 rounded-lg bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800">
    <p class="text-sm text-yellow-700 dark:text-yellow-300 flex items-center gap-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
        </svg>
        JD not yet analyzed
    </p>
</div>
{% endif %}

<!-- Raw Description -->
{% if desc %}
<div class="border-t theme-border pt-4">
    <p class="text-sm theme-text-tertiary mb-2 font-medium">Full Description</p>
    <div class="text-sm theme-text-secondary whitespace-pre-wrap break-words leading-relaxed max-h-[50vh] overflow-y-auto">{{ desc }}</div>
</div>
{% endif %}
