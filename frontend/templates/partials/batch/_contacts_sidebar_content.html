{# Contacts sidebar content - loaded via HTMX/fetch #}
{# Displays primary and secondary contacts with action buttons #}

<div class="p-4 space-y-6">
    {# Job info header #}
    <div class="pb-3 border-b theme-border">
        <h3 class="font-medium theme-text-primary">{{ job.title or 'Untitled Position' }}</h3>
        <p class="text-sm theme-text-secondary">{{ job.company or 'Unknown Company' }}</p>
    </div>

    {# Primary Contacts #}
    {% set primary_contacts = job.primary_contacts if job.primary_contacts else [] %}
    {% if primary_contacts | length > 0 %}
    <div>
        <h4 class="text-xs font-semibold text-indigo-600 dark:text-indigo-400 uppercase tracking-wide mb-3 flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
            </svg>
            Primary Contacts ({{ primary_contacts | length }})
        </h4>
        <div class="space-y-3">
            {% for contact in primary_contacts %}
            <div class="contact-card p-3 bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-200 dark:border-indigo-800 rounded-lg"
                 data-contact-type="primary"
                 data-contact-index="{{ loop.index0 }}">
                {# Contact Header #}
                <div class="flex justify-between items-start mb-2">
                    <div class="flex-1 min-w-0">
                        <div class="font-medium text-sm theme-text-primary flex items-center gap-2 flex-wrap">
                            <span class="truncate">{{ contact.name or contact.contact_name or 'Unknown' }}</span>
                            {% if contact.is_synthetic %}
                            <span class="px-1.5 py-0.5 text-[10px] font-medium bg-amber-100 text-amber-700 dark:bg-amber-900/50 dark:text-amber-300 rounded flex-shrink-0">
                                Placeholder
                            </span>
                            {% endif %}
                        </div>
                        <div class="text-xs theme-text-secondary truncate">{{ contact.role or contact.contact_role or 'Role not specified' }}</div>
                    </div>
                    <div class="flex items-center gap-1 flex-shrink-0 ml-2">
                        {% if contact.linkedin_url %}
                        <a href="{{ contact.linkedin_url }}" target="_blank" rel="noopener"
                           class="p-1.5 text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-200 hover:bg-indigo-100 dark:hover:bg-indigo-800/50 rounded transition"
                           title="Open LinkedIn profile">
                            <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                            </svg>
                        </a>
                        {% endif %}
                        {% if contact.email %}
                        <a href="mailto:{{ contact.email }}"
                           class="p-1.5 theme-text-secondary hover:text-accent-500 hover:bg-gray-100 dark:hover:bg-gray-800 rounded transition"
                           title="Send email">
                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                            </svg>
                        </a>
                        {% endif %}
                    </div>
                </div>

                {# Action Buttons #}
                {% set contact_name = (contact.name or contact.contact_name or 'Unknown') | e | replace("'", "\\'") %}
                {% set contact_role = (contact.role or contact.contact_role or '') | e | replace("'", "\\'") %}
                <div class="flex gap-2 mt-3">
                    <button onclick="generateOutreach('{{ contact_name }}', '{{ contact_role }}', 'inmail', this)"
                            class="flex-1 px-2.5 py-1.5 text-xs font-medium bg-indigo-100 dark:bg-indigo-800/50 text-indigo-700 dark:text-indigo-200 rounded hover:bg-indigo-200 dark:hover:bg-indigo-700/50 transition flex items-center justify-center gap-1.5">
                        <svg class="h-3.5 w-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                        Generate InMail
                    </button>
                    <button onclick="generateOutreach('{{ contact_name }}', '{{ contact_role }}', 'connection', this)"
                            class="flex-1 px-2.5 py-1.5 text-xs font-medium bg-green-100 dark:bg-green-800/50 text-green-700 dark:text-green-200 rounded hover:bg-green-200 dark:hover:bg-green-700/50 transition flex items-center justify-center gap-1.5">
                        <svg class="h-3.5 w-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/>
                        </svg>
                        Connect Note
                    </button>
                </div>

                {# Existing Messages #}
                {% if contact.linkedin_inmail %}
                <div class="mt-3 p-2.5 bg-indigo-100/50 dark:bg-indigo-900/30 rounded border border-indigo-200/50 dark:border-indigo-700/50">
                    <div class="flex justify-between items-center mb-1.5">
                        <span class="text-xs font-medium text-indigo-700 dark:text-indigo-300">InMail Draft</span>
                        <button onclick='copyToClipboard({{ contact.linkedin_inmail | tojson }}, "InMail", this)'
                                class="text-xs text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-200 flex items-center gap-1 transition">
                            <svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                            </svg>
                            Copy
                        </button>
                    </div>
                    <div class="text-xs theme-text-secondary line-clamp-3">{{ contact.linkedin_inmail }}</div>
                </div>
                {% endif %}

                {% if contact.linkedin_connection_message or contact.linkedin_message %}
                {% set conn_msg = contact.linkedin_connection_message or contact.linkedin_message %}
                <div class="mt-2 p-2.5 bg-green-100/50 dark:bg-green-900/30 rounded border border-green-200/50 dark:border-green-700/50">
                    <div class="flex justify-between items-center mb-1.5">
                        <span class="text-xs font-medium text-green-700 dark:text-green-300">Connection Request</span>
                        <button onclick='copyToClipboard({{ conn_msg | tojson }}, "Connection request", this)'
                                class="text-xs text-green-600 dark:text-green-400 hover:text-green-800 dark:hover:text-green-200 flex items-center gap-1 transition">
                            <svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                            </svg>
                            Copy
                        </button>
                    </div>
                    <div class="text-xs theme-text-secondary line-clamp-2">{{ conn_msg }}</div>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {# Secondary Contacts #}
    {% set secondary_contacts = job.secondary_contacts if job.secondary_contacts else [] %}
    {% if secondary_contacts | length > 0 %}
    <div>
        <h4 class="text-xs font-semibold theme-text-tertiary uppercase tracking-wide mb-3 flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/>
            </svg>
            Secondary Contacts ({{ secondary_contacts | length }})
        </h4>
        <div class="space-y-3">
            {% for contact in secondary_contacts %}
            <div class="contact-card p-3 bg-gray-50 dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg"
                 data-contact-type="secondary"
                 data-contact-index="{{ loop.index0 }}">
                {# Contact Header #}
                <div class="flex justify-between items-start mb-2">
                    <div class="flex-1 min-w-0">
                        <div class="font-medium text-sm theme-text-primary truncate">
                            {{ contact.name or contact.contact_name or 'Unknown' }}
                        </div>
                        <div class="text-xs theme-text-secondary truncate">{{ contact.role or contact.contact_role or 'Role not specified' }}</div>
                    </div>
                    <div class="flex items-center gap-1 flex-shrink-0 ml-2">
                        {% if contact.linkedin_url %}
                        <a href="{{ contact.linkedin_url }}" target="_blank" rel="noopener"
                           class="p-1.5 theme-text-secondary hover:text-accent-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition"
                           title="Open LinkedIn profile">
                            <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                            </svg>
                        </a>
                        {% endif %}
                        {% if contact.email %}
                        <a href="mailto:{{ contact.email }}"
                           class="p-1.5 theme-text-secondary hover:text-accent-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition"
                           title="Send email">
                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                            </svg>
                        </a>
                        {% endif %}
                    </div>
                </div>

                {# Action Buttons #}
                {% set sec_contact_name = (contact.name or contact.contact_name or 'Unknown') | e | replace("'", "\\'") %}
                {% set sec_contact_role = (contact.role or contact.contact_role or '') | e | replace("'", "\\'") %}
                <div class="flex gap-2 mt-2">
                    <button onclick="generateOutreach('{{ sec_contact_name }}', '{{ sec_contact_role }}', 'connection', this)"
                            class="flex-1 px-2.5 py-1.5 text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded hover:bg-gray-200 dark:hover:bg-gray-600 transition flex items-center justify-center gap-1.5">
                        <svg class="h-3.5 w-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/>
                        </svg>
                        Generate Connect Note
                    </button>
                </div>

                {# Existing Messages #}
                {% if contact.linkedin_connection_message or contact.linkedin_message %}
                {% set conn_msg = contact.linkedin_connection_message or contact.linkedin_message %}
                <div class="mt-2 p-2.5 bg-green-50 dark:bg-green-900/20 rounded border border-green-200/50 dark:border-green-700/50">
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-xs font-medium text-green-700 dark:text-green-300">Connection Request</span>
                        <button onclick='copyToClipboard({{ conn_msg | tojson }}, "Connection request", this)'
                                class="text-xs text-green-600 hover:text-green-800 flex items-center gap-1">
                            <svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                            </svg>
                            Copy
                        </button>
                    </div>
                    <div class="text-xs theme-text-secondary line-clamp-2">{{ conn_msg }}</div>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {# No contacts state #}
    {% if (primary_contacts | length == 0) and (secondary_contacts | length == 0) %}
    <div class="text-center py-12">
        <svg class="h-16 w-16 mx-auto theme-text-tertiary mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/>
        </svg>
        <p class="theme-text-secondary font-medium mb-1">No contacts discovered yet</p>
        <p class="theme-text-tertiary text-sm">Run the research pipeline to discover contacts for this role.</p>
    </div>
    {% endif %}
</div>
