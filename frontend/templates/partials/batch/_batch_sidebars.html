{# Batch Page Sidebars Container #}
{# Contains overlay and three slide-out sidebars for JD annotations, contacts, and CV editor #}

<!-- Global Overlay for all sidebars -->
<!-- z-[1035] ensures overlay is above CLI panel (z-1030) but below sidebars (z-[1040]) -->
<div id="batch-sidebar-overlay"
     class="fixed inset-0 bg-black/50 z-[1035] hidden opacity-0 transition-opacity duration-200"
     onclick="closeBatchSidebar()"
     role="presentation"
     aria-hidden="true">
</div>

<!-- JD Annotation Sidebar -->
<!-- z-[1040] ensures sidebar is above CLI panel (z-1030) and overlay (z-[1035]) -->
<div id="batch-annotation-sidebar"
     class="fixed inset-y-0 right-0 w-11/12 sm:w-3/4 lg:w-2/3 bg-white dark:bg-gray-900 shadow-2xl
            transform translate-x-full transition-transform duration-300 ease-in-out z-[1040] flex flex-col"
     role="dialog"
     aria-labelledby="batch-annotation-title"
     aria-modal="true"
     data-sidebar-type="annotation">

    <!-- Compact Header - Single Row -->
    <div class="flex items-center justify-between px-3 py-2 border-b theme-border theme-bg-secondary flex-shrink-0">
        {# Left side: Close + Title + Separator + Job Info #}
        <div class="flex items-center gap-2 min-w-0 flex-1">
            <button onclick="closeBatchSidebar()"
                    class="theme-text-tertiary hover:theme-text-primary transition p-1.5 -ml-1 rounded hover:theme-bg-hover flex-shrink-0"
                    aria-label="Close annotation panel (Escape key)"
                    title="Close (Esc)">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
            <h2 id="batch-annotation-title" class="text-sm font-semibold theme-text-primary whitespace-nowrap">
                Annotate JD
            </h2>
            <span class="theme-text-tertiary">|</span>
            <span id="batch-annotation-job-info" class="text-xs theme-text-secondary truncate"></span>
        </div>

        {# Right side: Undo/Redo + Save + Open Full #}
        <div class="flex items-center gap-2 flex-shrink-0">
            {# Undo/Redo Buttons #}
            <div class="flex items-center gap-0.5">
                <button id="batch-header-undo-btn"
                        onclick="getActiveAnnotationManager()?.undo()"
                        disabled
                        class="undo-redo-btn p-1 rounded hover:theme-bg-hover disabled:opacity-40 disabled:cursor-not-allowed transition theme-text-tertiary"
                        title="Undo (Ctrl+Z)">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"/>
                    </svg>
                </button>
                <button id="batch-header-redo-btn"
                        onclick="getActiveAnnotationManager()?.redo()"
                        disabled
                        class="undo-redo-btn p-1 rounded hover:theme-bg-hover disabled:opacity-40 disabled:cursor-not-allowed transition theme-text-tertiary"
                        title="Redo (Ctrl+Shift+Z)">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6"/>
                    </svg>
                </button>
            </div>

            {# Save Indicator - Compact #}
            <span id="batch-annotation-save-indicator"
                  class="text-xs theme-text-tertiary"
                  role="status"
                  aria-live="polite">
                <span class="text-green-500 dark:text-green-400">Saved</span>
            </span>

            {# Open Full Link #}
            <a id="batch-annotation-detail-link" href="#"
               class="text-xs text-accent-500 hover:text-accent-400 flex items-center gap-1 whitespace-nowrap"
               title="Open in full page view">
                <span class="hidden sm:inline">Open Full</span>
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                </svg>
            </a>
        </div>
    </div>

    <!-- Content loaded via HTMX -->
    <!-- Note: overflow-hidden here, scrolling happens inside the JD viewer area -->
    <div id="batch-annotation-content" class="flex-1 overflow-hidden min-h-0">
        <div class="flex items-center justify-center h-full">
            <svg class="animate-spin h-8 w-8 text-accent-500" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
            </svg>
        </div>
    </div>
</div>

<!-- Contacts Sidebar -->
<!-- z-[1040] ensures sidebar is above CLI panel (z-1030) -->
<div id="batch-contacts-sidebar"
     class="fixed inset-y-0 right-0 w-96 max-w-[90vw] bg-white dark:bg-gray-900 shadow-2xl
            transform translate-x-full transition-transform duration-300 ease-in-out z-[1040] flex flex-col"
     role="dialog"
     aria-labelledby="batch-contacts-title"
     aria-modal="true"
     data-sidebar-type="contacts">

    <!-- Header -->
    <div class="flex items-center justify-between px-4 py-4 border-b theme-border theme-bg-secondary flex-shrink-0">
        <div class="flex items-center space-x-3">
            <button onclick="closeBatchSidebar()"
                    class="theme-text-tertiary hover:theme-text-primary transition p-2 -ml-2 rounded-lg hover:theme-bg-hover"
                    aria-label="Close contacts panel"
                    title="Close (Esc)">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
            <div>
                <h2 id="batch-contacts-title" class="text-lg font-semibold theme-text-primary">
                    Contacts
                </h2>
                <span id="batch-contacts-job-info" class="text-xs theme-text-tertiary"></span>
            </div>
        </div>
        <a id="batch-contacts-detail-link" href="#"
           class="text-sm text-accent-500 hover:text-accent-400 flex items-center gap-1">
            <span>View All</span>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
            </svg>
        </a>
    </div>

    <!-- Content loaded via HTMX -->
    <div id="batch-contacts-content" class="flex-1 overflow-y-auto" style="overscroll-behavior: contain;">
        <div class="flex items-center justify-center h-full">
            <svg class="animate-spin h-8 w-8 text-accent-500" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
            </svg>
        </div>
    </div>
</div>

<!-- CV Editor Sidebar -->
<!-- z-[1040] ensures sidebar is above CLI panel (z-1030) -->
<div id="batch-cv-sidebar"
     class="fixed inset-y-0 right-0 w-11/12 sm:w-2/3 lg:w-1/2 bg-white dark:bg-gray-900 shadow-2xl
            transform translate-x-full transition-transform duration-300 ease-in-out z-[1040] flex flex-col"
     role="dialog"
     aria-labelledby="batch-cv-title"
     aria-modal="true"
     data-sidebar-type="cv">

    <!-- Header -->
    <div class="flex items-center justify-between px-4 sm:px-6 py-4 border-b theme-border theme-bg-secondary flex-shrink-0">
        <div class="flex items-center space-x-2 sm:space-x-4">
            <button onclick="closeBatchSidebar()"
                    class="theme-text-tertiary hover:theme-text-primary transition p-2 -ml-2 rounded-lg hover:theme-bg-hover"
                    aria-label="Close CV editor"
                    title="Close (Esc)">
                <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
            <div>
                <h2 id="batch-cv-title" class="text-base sm:text-lg font-semibold theme-text-primary">
                    CV Editor
                </h2>
                <span id="batch-cv-job-info" class="text-xs theme-text-tertiary"></span>
            </div>
        </div>
        <div class="flex items-center gap-4">
            <span id="batch-cv-save-indicator" class="text-xs theme-text-tertiary hidden">
                <span class="text-green-500 flex items-center gap-1">
                    <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="6"/>
                    </svg>
                    Saved
                </span>
            </span>
            <a id="batch-cv-detail-link" href="#"
               class="text-sm text-accent-500 hover:text-accent-400 flex items-center gap-1">
                <span>Open Full Editor</span>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                </svg>
            </a>
        </div>
    </div>

    <!-- Content loaded via HTMX -->
    <div id="batch-cv-content" class="flex-1 overflow-y-auto theme-bg-tertiary" style="overscroll-behavior: contain;">
        <div class="flex items-center justify-center h-full">
            <svg class="animate-spin h-8 w-8 text-accent-500" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
            </svg>
        </div>
    </div>
</div>

<!-- JD Preview Sidebar -->
<!-- z-[1040] ensures sidebar is above CLI panel (z-1030) and overlay (z-[1035]) -->
<div id="batch-jd-preview-sidebar"
     class="fixed inset-y-0 right-0 w-[28rem] max-w-[90vw] bg-white dark:bg-gray-900 shadow-2xl
            transform translate-x-full transition-transform duration-300 ease-in-out z-[1040] flex flex-col"
     role="dialog"
     aria-labelledby="batch-jd-preview-title"
     aria-modal="true"
     data-sidebar-type="jd-preview">

    <!-- Header -->
    <div class="flex items-center justify-between px-4 py-4 border-b theme-border theme-bg-secondary flex-shrink-0">
        <div class="flex items-center space-x-3">
            <button onclick="closeBatchSidebar()"
                    class="theme-text-tertiary hover:theme-text-primary transition p-2 -ml-2 rounded-lg hover:theme-bg-hover"
                    aria-label="Close job description preview"
                    title="Close (Esc)">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
            <div>
                <h2 id="batch-jd-preview-title" class="text-lg font-semibold theme-text-primary">
                    Job Description
                </h2>
                <span id="batch-jd-preview-job-info" class="text-xs theme-text-tertiary"></span>
            </div>
        </div>
        <a id="batch-jd-preview-detail-link" href="#"
           class="text-sm text-accent-500 hover:text-accent-400 flex items-center gap-1">
            <span>Open Details</span>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
            </svg>
        </a>
    </div>

    <!-- Content loaded via fetch - padding handled by jd-preview-panel -->
    <div id="batch-jd-preview-content" class="flex-1 overflow-y-auto" style="overscroll-behavior: contain;">
        <div class="jd-loading">
            <div class="jd-loading-spinner"></div>
        </div>
    </div>
</div>

{# Annotation Popover - Shared between batch and job detail pages #}
{# Uses the same popover template for consistent behavior #}
{% include 'partials/job_detail/_annotation_popover.html' %}
