<!-- Opportunities table partial — HTMX swappable -->
{% if items %}
<table class="w-full text-sm">
    <thead>
        <tr class="border-b" style="border-color: var(--border-default);">
            <th class="px-3 py-2 text-left text-xs font-medium uppercase" style="color: var(--text-tertiary);">Score</th>
            <th class="px-3 py-2 text-left text-xs font-medium uppercase" style="color: var(--text-tertiary);">Type</th>
            <th class="px-3 py-2 text-left text-xs font-medium uppercase" style="color: var(--text-tertiary);">Title</th>
            <th class="px-3 py-2 text-left text-xs font-medium uppercase hidden sm:table-cell" style="color: var(--text-tertiary);">Company/Author</th>
            <th class="px-3 py-2 text-left text-xs font-medium uppercase hidden md:table-cell" style="color: var(--text-tertiary);">Category</th>
            <th class="px-3 py-2 text-left text-xs font-medium uppercase hidden lg:table-cell" style="color: var(--text-tertiary);">Date</th>
            <th class="px-3 py-2 text-right text-xs font-medium uppercase" style="color: var(--text-tertiary);">Actions</th>
        </tr>
    </thead>
    <tbody class="divide-y" style="border-color: var(--border-default);">
        {% for item in items %}
        <tr class="hover:transition-colors" id="row-{{ item._id }}">
            <td class="px-3 py-2">
                {% set score = item.relevance_score | default(0, true) %}
                <span class="inline-flex items-center justify-center w-7 h-7 rounded text-xs font-bold
                    {% if score >= 9 %}bg-green-500/20 text-green-400
                    {% elif score >= 7 %}bg-yellow-500/20 text-yellow-400
                    {% elif score >= 5 %}bg-orange-500/20 text-orange-400
                    {% else %}bg-gray-500/20 text-gray-400{% endif %}">
                    {{ item.relevance_score or '?' }}
                </span>
            </td>
            <td class="px-3 py-2">
                <span class="text-xs px-1.5 py-0.5 rounded uppercase" style="background-color: var(--bg-hover); color: var(--text-secondary);">
                    {{ item.type or 'unknown' }}
                </span>
            </td>
            <td class="px-3 py-2 max-w-xs truncate" style="color: var(--text-primary);">
                {{ item.title or 'Untitled' }}
                {% if item.edge_opportunities %}
                <span class="ml-1 text-xs text-purple-400" title="{{ item.edge_opportunities | join(', ') }}">
                    [{{ item.edge_opportunities | length }} edge]
                </span>
                {% endif %}
                {% if item.acted_on %}
                <span class="ml-1 text-xs text-green-400">{{ item.acted_action or 'acted' }}</span>
                {% endif %}
            </td>
            <td class="px-3 py-2 hidden sm:table-cell truncate" style="color: var(--text-secondary);">
                {{ item.company or item.author or '—' }}
            </td>
            <td class="px-3 py-2 hidden md:table-cell">
                <span class="text-xs" style="color: var(--text-tertiary);">
                    {{ item.classification.category if item.classification else '—' }}
                </span>
            </td>
            <td class="px-3 py-2 hidden lg:table-cell text-xs" style="color: var(--text-tertiary);">
                {{ item.scraped_at.strftime('%b %d %H:%M') if item.scraped_at else '—' }}
            </td>
            <td class="px-3 py-2 text-right">
                <div class="flex items-center justify-end gap-1">
                    <button hx-get="/dashboard/opportunities/{{ item._id }}"
                            hx-target="#detail-modal-content"
                            hx-swap="innerHTML"
                            onclick="document.getElementById('detail-modal').classList.remove('hidden')"
                            class="px-2 py-1 text-xs rounded"
                            style="background-color: var(--bg-hover); color: var(--text-secondary);">
                        View
                    </button>
                    {% if item.type == 'job' and not item.acted_on %}
                    <button hx-post="/dashboard/opportunities/{{ item._id }}/pipeline"
                            hx-target="#row-{{ item._id }}"
                            hx-swap="outerHTML"
                            class="px-2 py-1 text-xs rounded bg-indigo-600/20 text-indigo-400">
                        Pipeline
                    </button>
                    {% endif %}
                    {% if not item.acted_on %}
                    <button hx-post="/dashboard/opportunities/{{ item._id }}/action"
                            hx-vals='{"action": "saved"}'
                            hx-target="#row-{{ item._id }}"
                            hx-swap="outerHTML"
                            class="px-2 py-1 text-xs rounded"
                            style="background-color: var(--bg-hover); color: var(--text-secondary);">
                        Save
                    </button>
                    <button hx-post="/dashboard/opportunities/{{ item._id }}/action"
                            hx-vals='{"action": "skipped"}'
                            hx-target="#row-{{ item._id }}"
                            hx-swap="outerHTML"
                            class="px-2 py-1 text-xs rounded text-red-400/70"
                            style="background-color: var(--bg-hover);">
                        Skip
                    </button>
                    {% endif %}
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Pagination -->
{% if total_pages > 1 %}
<div class="flex items-center justify-between px-4 py-3 border-t" style="border-color: var(--border-default);">
    <span class="text-xs" style="color: var(--text-tertiary);">
        {{ total }} items total — Page {{ page }} of {{ total_pages }}
    </span>
    <div class="flex gap-1">
        {% if page > 1 %}
        <button hx-get="/dashboard/opportunities/rows?page={{ page - 1 }}&per_page={{ per_page }}"
                hx-target="#opportunities-table"
                hx-swap="innerHTML"
                class="px-2 py-1 text-xs rounded"
                style="background-color: var(--bg-hover); color: var(--text-secondary);">
            Prev
        </button>
        {% endif %}
        {% if page < total_pages %}
        <button hx-get="/dashboard/opportunities/rows?page={{ page + 1 }}&per_page={{ per_page }}"
                hx-target="#opportunities-table"
                hx-swap="innerHTML"
                class="px-2 py-1 text-xs rounded"
                style="background-color: var(--bg-hover); color: var(--text-secondary);">
            Next
        </button>
        {% endif %}
    </div>
</div>
{% endif %}

{% else %}
<div class="px-4 py-8 text-center" style="color: var(--text-tertiary);">
    <p class="text-sm">No items match your filters</p>
</div>
{% endif %}
