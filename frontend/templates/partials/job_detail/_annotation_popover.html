{# Annotation Popover - Appears when user selects text in JD viewer #}
{# This floating popover enables quick annotation creation #}

<div id="annotation-popover"
     class="fixed z-[60] hidden bg-white rounded-lg shadow-xl border border-gray-200 p-4 w-80"
     role="dialog"
     aria-labelledby="popover-title"
     style="max-height: 80vh; overflow-y: auto;">

    {# Header #}
    <div class="flex items-center justify-between mb-3 pb-2 border-b border-gray-100">
        <h3 id="popover-title" class="text-sm font-semibold text-gray-900">Create Annotation</h3>
        <button onclick="hideAnnotationPopover()"
                class="text-gray-400 hover:text-gray-600 p-1"
                aria-label="Close popover">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
        </button>
    </div>

    {# Selected Text Preview #}
    <div class="mb-3">
        <label class="block text-xs font-medium text-gray-500 uppercase mb-1">Selected Text</label>
        <p id="popover-selected-text" class="text-sm text-gray-800 bg-yellow-50 p-2 rounded border border-yellow-200 line-clamp-3"></p>
    </div>

    {# Relevance Level #}
    <div class="mb-3">
        <label class="block text-xs font-medium text-gray-500 uppercase mb-2">Match Strength</label>
        <div class="grid grid-cols-5 gap-1">
            <button type="button"
                    onclick="setPopoverRelevance('core_strength')"
                    data-relevance="core_strength"
                    class="relevance-btn px-2 py-1.5 rounded text-xs font-medium text-center transition
                           bg-green-50 text-green-700 border border-green-200 hover:bg-green-100"
                    title="5+ years direct experience; could teach others">
                Core
            </button>
            <button type="button"
                    onclick="setPopoverRelevance('extremely_relevant')"
                    data-relevance="extremely_relevant"
                    class="relevance-btn px-2 py-1.5 rounded text-xs font-medium text-center transition
                           bg-emerald-50 text-emerald-700 border border-emerald-200 hover:bg-emerald-100"
                    title="3-5 years; used daily in recent role">
                Strong
            </button>
            <button type="button"
                    onclick="setPopoverRelevance('relevant')"
                    data-relevance="relevant"
                    class="relevance-btn px-2 py-1.5 rounded text-xs font-medium text-center transition
                           bg-yellow-50 text-yellow-700 border border-yellow-200 hover:bg-yellow-100"
                    title="1-3 years; transferable with minor framing">
                Medium
            </button>
            <button type="button"
                    onclick="setPopoverRelevance('tangential')"
                    data-relevance="tangential"
                    class="relevance-btn px-2 py-1.5 rounded text-xs font-medium text-center transition
                           bg-orange-50 text-orange-700 border border-orange-200 hover:bg-orange-100"
                    title="Less than 1 year; requires significant reframing">
                Weak
            </button>
            <button type="button"
                    onclick="setPopoverRelevance('gap')"
                    data-relevance="gap"
                    class="relevance-btn px-2 py-1.5 rounded text-xs font-medium text-center transition
                           bg-red-50 text-red-700 border border-red-200 hover:bg-red-100"
                    title="No experience; needs mitigation strategy">
                Gap
            </button>
        </div>
    </div>

    {# Requirement Type #}
    <div class="mb-3">
        <label class="block text-xs font-medium text-gray-500 uppercase mb-2">Requirement Type</label>
        <div class="flex gap-2">
            <button type="button"
                    onclick="setPopoverRequirement('must_have')"
                    data-requirement="must_have"
                    class="requirement-btn flex-1 px-3 py-1.5 rounded text-xs font-medium text-center transition
                           bg-blue-50 text-blue-700 border border-blue-200 hover:bg-blue-100"
                    title="Required/essential for the role">
                Must-Have
            </button>
            <button type="button"
                    onclick="setPopoverRequirement('nice_to_have')"
                    data-requirement="nice_to_have"
                    class="requirement-btn flex-1 px-3 py-1.5 rounded text-xs font-medium text-center transition
                           bg-gray-50 text-gray-600 border border-gray-200 hover:bg-gray-100"
                    title="Preferred but not required">
                Nice-to-Have
            </button>
            <button type="button"
                    onclick="setPopoverRequirement('neutral')"
                    data-requirement="neutral"
                    class="requirement-btn flex-1 px-3 py-1.5 rounded text-xs font-medium text-center transition
                           bg-gray-50 text-gray-500 border border-gray-200 hover:bg-gray-100"
                    title="Informational only">
                Neutral
            </button>
        </div>
    </div>

    {# Passion Level - How excited are you about this aspect? #}
    <div class="mb-3">
        <label class="block text-xs font-medium text-gray-500 uppercase mb-2">
            Your Passion Level
            <span class="text-gray-400 font-normal">(how excited are you about this?)</span>
        </label>
        <div class="flex flex-wrap gap-1">
            <button type="button"
                    onclick="setPopoverPassion('love_it')"
                    data-passion="love_it"
                    class="passion-btn px-2 py-1.5 rounded text-xs font-medium text-center transition whitespace-nowrap
                           bg-pink-50 text-pink-700 border border-pink-200 hover:bg-pink-100"
                    title="Genuinely excited - would love to do this daily">
                üî• Love
            </button>
            <button type="button"
                    onclick="setPopoverPassion('enjoy')"
                    data-passion="enjoy"
                    class="passion-btn px-2 py-1.5 rounded text-xs font-medium text-center transition whitespace-nowrap
                           bg-purple-50 text-purple-700 border border-purple-200 hover:bg-purple-100"
                    title="Would enjoy doing this regularly">
                üòä Enjoy
            </button>
            <button type="button"
                    onclick="setPopoverPassion('neutral')"
                    data-passion="neutral"
                    class="passion-btn px-2 py-1.5 rounded text-xs font-medium text-center transition whitespace-nowrap
                           bg-gray-50 text-gray-600 border border-gray-200 hover:bg-gray-100 ring-2 ring-gray-300"
                    title="Neither excited nor dreading - neutral">
                üòê Neutral
            </button>
            <button type="button"
                    onclick="setPopoverPassion('tolerate')"
                    data-passion="tolerate"
                    class="passion-btn px-2 py-1.5 rounded text-xs font-medium text-center transition whitespace-nowrap
                           bg-slate-50 text-slate-600 border border-slate-200 hover:bg-slate-100"
                    title="Can do it but would rather not emphasize">
                üòï Tolerate
            </button>
            <button type="button"
                    onclick="setPopoverPassion('avoid')"
                    data-passion="avoid"
                    class="passion-btn px-2 py-1.5 rounded text-xs font-medium text-center transition whitespace-nowrap
                           bg-stone-50 text-stone-600 border border-stone-200 hover:bg-stone-100"
                    title="Would strongly prefer to avoid this">
                üö´ Avoid
            </button>
        </div>
    </div>

    {# Identity Level - Does this define who you are professionally? #}
    <div class="mb-3">
        <label class="block text-xs font-medium text-gray-500 uppercase mb-2">
            Professional Identity
            <span class="text-gray-400 font-normal">(use in introductions?)</span>
        </label>
        <div class="flex flex-wrap gap-1">
            <button type="button"
                    onclick="setPopoverIdentity('core_identity')"
                    data-identity="core_identity"
                    class="identity-btn px-2 py-1.5 rounded text-xs font-medium text-center transition whitespace-nowrap
                           bg-indigo-50 text-indigo-700 border border-indigo-200 hover:bg-indigo-100"
                    title="This IS who I am - use in headlines and introductions">
                ‚≠ê Core
            </button>
            <button type="button"
                    onclick="setPopoverIdentity('strong_identity')"
                    data-identity="strong_identity"
                    class="identity-btn px-2 py-1.5 rounded text-xs font-medium text-center transition whitespace-nowrap
                           bg-violet-50 text-violet-700 border border-violet-200 hover:bg-violet-100"
                    title="Significant part of my professional identity">
                üí™ Strong
            </button>
            <button type="button"
                    onclick="setPopoverIdentity('developing')"
                    data-identity="developing"
                    class="identity-btn px-2 py-1.5 rounded text-xs font-medium text-center transition whitespace-nowrap
                           bg-cyan-50 text-cyan-700 border border-cyan-200 hover:bg-cyan-100"
                    title="Growing into this identity - frame as development">
                üå± Growing
            </button>
            <button type="button"
                    onclick="setPopoverIdentity('peripheral')"
                    data-identity="peripheral"
                    class="identity-btn px-2 py-1.5 rounded text-xs font-medium text-center transition whitespace-nowrap
                           bg-gray-50 text-gray-600 border border-gray-200 hover:bg-gray-100 ring-2 ring-gray-300"
                    title="Not central to identity - include only if relevant">
                ‚óã Peripheral
            </button>
            <button type="button"
                    onclick="setPopoverIdentity('not_identity')"
                    data-identity="not_identity"
                    class="identity-btn px-2 py-1.5 rounded text-xs font-medium text-center transition whitespace-nowrap
                           bg-zinc-50 text-zinc-600 border border-zinc-200 hover:bg-zinc-100"
                    title="NOT how I want to be seen - avoid in introductions">
                ‚úó Not Me
            </button>
        </div>
    </div>

    {# STAR Story Links #}
    <div class="mb-3">
        <label class="block text-xs font-medium text-gray-500 uppercase mb-2">Link STAR Stories</label>
        <div id="popover-star-selector" class="max-h-32 overflow-y-auto border border-gray-200 rounded p-2 bg-gray-50">
            {# STAR checkboxes populated by JS #}
            <p class="text-xs text-gray-400 italic">Loading STAR stories...</p>
        </div>
    </div>

    {# Reframe Note (collapsible) #}
    <div class="mb-2" id="popover-reframe-container">
        <button type="button"
                onclick="togglePopoverField('reframe')"
                class="w-full flex items-center justify-between text-xs font-medium text-gray-500 uppercase py-1.5 hover:text-gray-700 hover:bg-gray-50 rounded transition">
            <span class="flex items-center gap-1">
                <svg class="w-3 h-3 transition-transform duration-200" id="reframe-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
                Reframe Note <span class="text-gray-400 font-normal">(positioning tip)</span>
            </span>
        </button>
        <div id="reframe-content" class="hidden mt-1">
            <textarea id="popover-reframe-note"
                      class="w-full text-sm border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                      rows="2"
                      placeholder="e.g., 'While I haven't used X directly, my experience with Y demonstrates similar...'"></textarea>
        </div>
    </div>

    {# Strategic Note (collapsible) #}
    <div class="mb-2" id="popover-strategic-container">
        <button type="button"
                onclick="togglePopoverField('strategic')"
                class="w-full flex items-center justify-between text-xs font-medium text-gray-500 uppercase py-1.5 hover:text-gray-700 hover:bg-gray-50 rounded transition">
            <span class="flex items-center gap-1">
                <svg class="w-3 h-3 transition-transform duration-200" id="strategic-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
                Strategic Note <span class="text-gray-400 font-normal">(LLM guidance)</span>
            </span>
        </button>
        <div id="strategic-content" class="hidden mt-1">
            <textarea id="popover-strategic-note"
                      class="w-full text-sm border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                      rows="2"
                      placeholder="e.g., 'Emphasize Linux passion throughout CV and cover letter'"></textarea>
            <p class="text-xs text-gray-400 mt-1">Influences CV, cover letters, and outreach.</p>
        </div>
    </div>

    {# ATS Keywords (collapsible) #}
    <div class="mb-3" id="popover-keywords-container">
        <button type="button"
                onclick="togglePopoverField('keywords')"
                class="w-full flex items-center justify-between text-xs font-medium text-gray-500 uppercase py-1.5 hover:text-gray-700 hover:bg-gray-50 rounded transition">
            <span class="flex items-center gap-1">
                <svg class="w-3 h-3 transition-transform duration-200" id="keywords-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
                ATS Keywords <span class="text-gray-400 font-normal">(comma separated)</span>
            </span>
        </button>
        <div id="keywords-content" class="hidden mt-1">
            <input type="text"
                   id="popover-keywords"
                   class="w-full text-sm border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                   placeholder="e.g., Kubernetes, K8s, container orchestration">
        </div>
    </div>

    {# Actions - Compact, right-aligned #}
    <div class="flex items-center justify-end gap-2 pt-1.5 mt-1 border-t border-gray-100">
        {# Delete button - only shown when editing existing annotation #}
        <button onclick="deleteAnnotationFromPopover()"
                id="popover-delete-btn"
                class="hidden px-2 py-1 text-xs font-medium text-red-600 hover:text-red-700 hover:bg-red-50 rounded transition"
                title="Delete this annotation">
            Delete
        </button>
        <button onclick="hideAnnotationPopover()"
                class="px-2 py-1 text-xs text-gray-500 hover:text-gray-700 transition">
            Cancel
        </button>
        <button onclick="saveAnnotationFromPopover()"
                id="popover-save-btn"
                class="px-2.5 py-1 text-xs font-medium rounded bg-indigo-600 text-white hover:bg-indigo-700 transition
                       disabled:opacity-50 disabled:cursor-not-allowed"
                disabled>
            Save
        </button>
    </div>
</div>
