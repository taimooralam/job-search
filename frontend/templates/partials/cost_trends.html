<!-- Cost Trends Widget (Gap #15) -->
{% if error %}
<div class="bg-red-50 border border-red-200 rounded-lg p-3 text-red-600 text-sm">
    <div class="flex items-center gap-2">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
        </svg>
        <span>Cost data unavailable: {{ error }}</span>
    </div>
</div>
{% else %}
<div class="panel p-3">
    <!-- Header -->
    <div class="flex items-center justify-between mb-3">
        <h3 class="text-sm font-semibold theme-text-secondary flex items-center gap-2">
            <svg class="w-4 h-4 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"/>
            </svg>
            Cost Trends
        </h3>
        <div class="flex items-center gap-2">
            <!-- Period Toggle -->
            <div class="flex rounded-md theme-bg-secondary p-0.5 text-xs">
                <button
                    hx-get="/partials/cost-trends?period=hourly&count=24"
                    hx-target="#cost-trends-container"
                    hx-swap="innerHTML"
                    class="px-2 py-1 rounded {% if period == 'hourly' %}theme-bg-card shadow-sm theme-text-primary{% else %}theme-text-muted hover:theme-text-primary{% endif %}">
                    24h
                </button>
                <button
                    hx-get="/partials/cost-trends?period=daily&count=7"
                    hx-target="#cost-trends-container"
                    hx-swap="innerHTML"
                    class="px-2 py-1 rounded {% if period == 'daily' %}theme-bg-card shadow-sm theme-text-primary{% else %}theme-text-muted hover:theme-text-primary{% endif %}">
                    7d
                </button>
            </div>
            <span class="text-xs theme-text-muted">#15</span>
        </div>
    </div>

    <!-- Sparkline with Summary -->
    <div class="flex items-center gap-4">
        <!-- Sparkline -->
        <div class="flex-grow">
            <div class="h-12 flex items-center">
                {{ sparkline_svg|safe }}
            </div>
            <div class="flex justify-between text-xs theme-text-muted mt-1">
                {% if costs %}
                <span>{{ costs[0].period[-8:] if period == 'hourly' else costs[0].period[-5:] }}</span>
                <span>{{ costs[-1].period[-8:] if period == 'hourly' else costs[-1].period[-5:] }}</span>
                {% else %}
                <span>No data</span>
                <span></span>
                {% endif %}
            </div>
        </div>

        <!-- Summary Stats -->
        <div class="text-right space-y-1 min-w-[100px]">
            <div>
                <div class="text-xs theme-text-muted">Total</div>
                <div class="text-sm font-semibold theme-text-primary">${{ "%.4f"|format(summary.total_cost_usd) }}</div>
            </div>
            <div>
                <div class="text-xs theme-text-muted">Avg/{{ 'hour' if period == 'hourly' else 'day' }}</div>
                <div class="text-xs theme-text-secondary">${{ "%.6f"|format(summary.avg_cost_usd) }}</div>
            </div>
            {% if summary.max_cost_usd > 0 %}
            <div>
                <div class="text-xs theme-text-muted">Peak</div>
                <div class="text-xs text-emerald-600 dark:text-emerald-400">${{ "%.6f"|format(summary.max_cost_usd) }}</div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Detailed breakdown (collapsible) -->
    {% if costs and costs|length > 0 %}
    <details class="mt-4">
        <summary class="text-xs theme-text-tertiary cursor-pointer hover:theme-text-primary">
            View detailed breakdown ({{ costs|length }} periods)
        </summary>
        <div class="mt-2 max-h-32 overflow-y-auto">
            <table class="w-full text-xs">
                <thead class="theme-text-tertiary">
                    <tr>
                        <th class="text-left py-1">{{ 'Hour' if period == 'hourly' else 'Date' }}</th>
                        <th class="text-right py-1">Cost</th>
                        <th class="text-right py-1">Calls</th>
                    </tr>
                </thead>
                <tbody class="theme-text-secondary">
                    {% for item in costs|reverse %}
                    <tr class="border-t theme-border">
                        <td class="py-1">{{ item.period[-11:] if period == 'hourly' else item.period }}</td>
                        <td class="text-right py-1">${{ "%.6f"|format(item.cost_usd) }}</td>
                        <td class="text-right py-1 theme-text-muted">{{ item.calls }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </details>
    {% endif %}
</div>
{% endif %}
